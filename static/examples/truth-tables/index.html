<!DOCTYPE html>
<html>
<head>
    <title>Truth Tables | CI - Neural Networks</title>
    <script type="text/javascript" src="/src/bundle.js"></script>
    <script type="text/javascript">
        var ANN = require('NeuralNetwork');
        var tables = require('truth-tables');
        var $ = require('jquery');
        var NetworkUtil = require('NetworkUtil');

        /**
         * @param options
         * @returns {NeuralNetwork}
         */
        function getNeuralNetwork(options) {
            var settings = $.extend({
                inputLayerCount: Number($('#inputs').val()),
                hiddenLayerCount: Number($('#hiddenLayerCount').val()),
                hiddenLayerNeuronCount: Number($('#hiddenLayerLength').val()),
                eta: Number($('#eta').val()),
            }, options);
            return new ANN(settings);
        }

        function getTrainingSet() {
            return tables[$('#data-set').val()]();
        }

        function setUi() {
            var inputs = Number($('#inputs').val());
            var $inputDiv = $('.inputs');
            $inputDiv.empty();

            for (var i = 0; i < inputs; i++) {
                $inputDiv.append('<input type="text" id="input-' + i + '" value="' + i + '">');
            }
        }


        $(function() {
            var $output = $('#output');
            var $network = $('#network');
            var t;
            /** @type NeuralNetwork */
            var network;

            reset();

            $('#test').click(function() {
                var results = NetworkUtil.five2Training(network, t);
                $output.html(results);
                $network.html(network.toString());
            });

            $('#train').click(function() {
                NetworkUtil.train(network, t, Number($('#button-panel #n').val()));
                $output.html(network.getOutput());
                $network.html(network.toString());
            });

            $('#train-once').click(function() {
                var n = Number($('#button-panel #x').val());
                for (var i = 0; i < n; i++) {

                    NetworkUtil.trainOnce(network, t);
                }
                $output.html(network.getOutput());
                $network.html(network.toString());
            });

            $('#new').click(function() {
                reset();
            });

            $('#manual-test').click(function() {
                var inputs = [];
                var inputCount = Number($('#inputs').val());

                for (var i = 0; i < inputCount; i++) {
                    inputs.push(Number($('#input-' + i).val()));
                }

                network.test(inputs);
                $output.html(network.getOutput());
                $network.html(network.toString());
            });

            function reset() {
                t = getTrainingSet();
                network = getNeuralNetwork();
                setUi();
            }
        });
    </script>
</head>
<body>
    Try Training: <br/>
    <div id='controls'>
        Inputs: <input type='text' id='inputs' value='2'>
        HiddenLayerLength: <input type='text' id='hiddenLayerLength' value='2'>
        HiddenLayerCount: <input type='text' id='hiddenLayerCount' value='0'>
        DataSet:
        <select id='data-set'>
            <option selected=selected value='XplusY'>x + y</option>
            <option value='XY'>x * y</option>
        </select>
        Eta: <input type='text' id='eta' value='0.5'>
        <button id='new'>Create ANN</button>
    </div>
    <div id='button-panel'>
        Test with input:
        <div class='inputs'>
        </div> <button id='manual-test'>Manual Test</button><br/>
        <button id='train'>Train</button><input type='text' id='n'><br/>
        <button id='train-once'>Train Once</button><input type='text' id='x'><br/>
        <button id='test'>Test</button>
    </div>
    <div id='output'></div>
    <div id='network'></div>
</body>
</html>